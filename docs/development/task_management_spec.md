# 散货体积监测系统 - 任务管理规格文档

## 一、系统概述

### 1.1 任务管理模块定位

任务管理模块是散货体积监测系统的核心功能之一，负责管理整个数据处理流程的任务创建、执行、监控和历史记录。该模块承担着将原始数据转化为最终分析结果的完整工作流程管理。

### 1.2 核心价值

- 流程自动化：将传统人工操作转化为自动化任务流程
- 质量管控：确保每个处理步骤的质量和可追溯性
- 效率提升：批量处理和并行执行提高工作效率
- 状态透明：实时监控任务执行状态和进度

## 二、业务逻辑与工作流程

### 2.1 数据处理流程

原始影像(YX) → 三维重建 → 模型数据(MX) + 点云数据(DY) → 清表 → 体积量算 → 结果报告

### 2.2 任务类型定义

#### 2.2.1 全流程任务（QLC）

- 任务代码：QLC（全流程）
- 输入数据：原始影像数据（YX-前缀）
- 处理步骤：
  - 三维重建
  - 分堆
  - 清表
  - 体积量算
- 输出结果：完整的体积分析报告
- 适用场景：需要完整处理流程的常规业务

#### 2.2.2 清表+体积量算任务（QTL）

- 任务代码：QTL（清表量算）
- 输入数据：模型数据（MX-前缀）+ 点云数据（DY-前缀）
- 处理步骤：
  - 清表
  - 体积量算
- 输出结果：体积分析报告
- 适用场景：基于已有模型进行清表和计算

#### 2.2.3 三维重建+分堆任务（SWF）

- 任务代码：SWF（三维分堆）
- 输入数据：原始影像数据（YX-前缀）
- 处理步骤：
  - 三维重建
  - 分堆
- 输出结果：模型数据和点云数据
- 适用场景：仅需要建模和分堆，后续人工处理

### 2.3 任务拆解策略

任务拆解主要针对两种特殊情况：

- 三维重建需求：当需要单独进行三维重建和分堆时，使用SWF任务
- AI清表无法全自动：当AI清表效果不理想需要人工干预时，先执行SWF任务，人工调整后再执行QTL任务

## 三、命名规范体系

### 3.1 任务命名规范

格式：任务前缀-堆场名-日期-第次-任务序号

示例：

- QLC-龙口煤场-2025-08-22-01-T001
- SWF-天津港-2025-08-22-01-T001
- QTL-日照港-2025-08-22-02-T001

### 3.2 命名组成说明

- 任务前缀：QLC/SWF/QTL，标识任务类型
- 堆场名：具体的作业堆场名称
- 日期：数据采集日期（YYYY-MM-DD格式）
- 第次：当日第几次采集（01、02、03…）
- 任务序号：同批次数据的任务编号（T001、T002…）

### 3.3 与数据命名的关联

任务处理的数据必须遵循数据管理的命名规范：

- 原始影像：YX-堆场名-日期-第次
- 模型数据：MX-堆场名-日期-第次
- 点云数据：DY-堆场名-日期-第次

## 四、数据依赖与验证机制

### 4.1 数据前置验证

创建任务前必须进行严格的数据依赖检查：

#### 4.1.1 QLC任务验证

- ✅ 检查是否存在对应的原始影像数据（YX-前缀）
- ✅ 验证堆场名称和日期匹配
- ✅ 确认数据完整性和可访问性

#### 4.1.2 SWF任务验证

- ✅ 检查是否存在对应的原始影像数据（YX-前缀）
- ✅ 验证堆场名称和日期匹配

#### 4.1.3 QTL任务验证

- ✅ 检查是否存在对应的模型数据（MX-前缀）
- ✅ 检查是否存在对应的点云数据（DY-前缀）
- ✅ 验证两种数据的堆场、日期、第次信息一致

### 4.2 验证失败处理

- 缺少数据时：显示明确警告，指出缺少的数据类型
- 数据不匹配时：提示用户检查数据源选择
- 阻止创建：验证不通过时禁用创建按钮

## 五、任务状态管理

### 5.1 任务状态定义

- pending：进行中 - 任务正在执行
- completed：已完成 - 任务成功完成
- failed：已失败 - 任务执行失败
- canceled：已取消 - 任务被手动取消

### 5.2 进度跟踪机制

每个任务维护详细的进度信息：

```javascript
progress: {
  current: 2,  // 当前步骤索引
  total: 4,    // 总步骤数
  steps: ['3d', 'pile', 'clear', 'volume']  // 步骤标识
}
```

### 5.3 状态转换规则

- 创建 → pending → completed/failed
- pending → canceled (手动取消)
- failed → pending (重试)

## 六、用户界面规范

### 6.1 创建任务界面

#### 6.1.1 步骤化设计

- 步骤1：选择任务类型（卡片式可视化选择）
- 步骤2：选择数据源（智能推荐+兼容性检查）
- 步骤3：任务配置（优先级+实时预览）

#### 6.1.2 交互规范

- 渐进式显示：只在必要时显示相关选项
- 实时验证：表单字段实时验证和状态管理
- 智能推荐：根据堆场和日期自动推荐数据源
- 兼容性提示：颜色编码显示数据兼容性状态

### 6.2 任务列表界面

#### 6.2.1 显示信息

- 任务名称、类型、数据来源
- 创建时间、状态、进度
- 优先级、操作按钮

#### 6.2.2 筛选功能

- 按任务类型筛选：全部/QLC/SWF/QTL
- 按状态筛选：全部/进行中/已完成/已失败
- 按堆场筛选：支持多堆场选择
- 按日期范围筛选

#### 6.2.3 批量操作

- 批量选择任务
- 批量重试失败任务
- 批量取消任务
- 批量删除历史任务

## 七、操作权限与安全

### 7.1 操作权限设计

- 查看权限：所有用户可查看任务状态和结果
- 创建权限：需要数据管理权限
- 管理权限：可以取消、重试、删除任务

### 7.2 数据安全机制

- 输入验证：严格验证所有用户输入
- 权限检查：操作前验证用户权限
- 日志记录：记录所有重要操作
- 数据完整性：确保任务数据不被意外修改

## 八、性能与扩展性

### 8.1 性能要求

- 响应时间：界面操作响应时间 < 200ms
- 并发处理：支持多任务并行执行
- 大数据处理：支持GB级别数据处理
- 实时更新：任务状态实时刷新

### 8.2 扩展性设计

- 插件化架构：支持新增处理步骤
- 配置驱动：任务流程可配置化
- API标准化：提供标准的任务管理API
- 分布式支持：支持分布式任务执行

## 九、错误处理与监控

### 9.1 错误分类

- 系统错误：服务器故障、网络中断
- 数据错误：数据格式错误、文件损坏
- 业务错误：参数配置错误、流程异常
- 用户错误：权限不足、操作违规

### 9.2 监控指标

- 任务成功率：按类型统计任务成功率
- 执行时间：各步骤平均执行时间
- 资源使用率：CPU、内存、存储使用情况
- 错误频率：各类错误的发生频率

## 十、集成接口

### 10.1 数据管理集成

- 获取可用数据源列表
- 验证数据源有效性
- 数据访问权限检查

### 10.2 3D可视化集成

- 任务结果数据传输
- 可视化参数配置
- 结果展示跳转

### 10.3 报表管理集成

- 任务执行结果导出
- 报表自动生成触发
- 统计数据同步

## 十一、技术实现

### 11.1 前端技术栈

- 框架：Vue 3.4.21 + TypeScript 5.4.5
- 构建工具：Vite 5.2.10
- UI组件：Element Plus 2.6.3
- 状态管理：Pinia 2.1.7
- 样式处理：Sass 1.75.0

### 11.2 核心功能实现

- 响应式表单：使用 Vue 3 Composition API
- 实时验证：computed 属性 + watch 监听
- 状态管理：Pinia store 管理全局状态
- 组件通信：事件总线 + props/emit

### 11.3 代码规范

- TypeScript严格模式：确保类型安全
- ESLint代码检查：统一代码风格
- 组件化设计：高内聚低耦合
- 注释规范：关键逻辑必须注释

---

*本文档版本：v1.0*  
*最后更新：2025-08-22*  
*维护者：开发团队*